# üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Database ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á

## üóÑÔ∏è Database ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ

### **Firebase Firestore (Cloud Firestore)**

**Path Structure:**
```
artifacts/{appId}/public/data/
‚îú‚îÄ‚îÄ users/          # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (User Database)
‚îÇ   ‚îî‚îÄ‚îÄ {userId}/   # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô
‚îî‚îÄ‚îÄ requests/       # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•
    ‚îî‚îÄ‚îÄ {requestId}/ # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Path:**
- Users: `artifacts/spu-hr-simple/public/data/users/{uid}`
- Requests: `artifacts/spu-hr-simple/public/data/requests/{requestId}`

**Demo Mode (Fallback):**
- ‡∏ñ‡πâ‡∏≤ Firebase ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏à‡∏∞‡πÉ‡∏ä‡πâ **localStorage** ‡πÅ‡∏ó‡∏ô
- Key: `spu_hr_users` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)
- Key: `spu_hr_requests` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠)

---

## üìù ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß

### 1. **‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (Register System)**
- ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ `RegisterPage.jsx`
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 4 ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó:
  - `hr`: ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
  - `vp_hr`: ‡∏£‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏î‡∏µ
  - `president`: ‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏î‡∏µ
  - `faculty`: ‡∏Ñ‡∏ì‡∏∞/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô

### 2. **User Database (`utils/userService.js`)**
- ‚úÖ `getUserData(uid)`: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏° UID
- ‚úÖ `getUserByEmail(email)`: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏° Email
- ‚úÖ `checkAccess(userData, role, facultyId)`: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
- ‚úÖ `checkEmailExists(email)`: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‚úÖ `checkEmailExistsInOtherFaculty(email, facultyId)`: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏µ‡πÉ‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

### 3. **Email/Password Authentication**
- ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `LoginPage.jsx` ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Email/Password
- ‚úÖ ‡πÉ‡∏ä‡πâ Firebase Authentication (`signInWithEmailAndPassword`)
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏≤‡∏° role ‡πÅ‡∏•‡∏∞ faculty

### 4. **Role-based Access Control**
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ role ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‚úÖ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Faculty: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ email ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö facultyId ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

### 5. **UI Updates**
- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•" ‡πÄ‡∏õ‡πá‡∏ô "HR SPU"
- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login
- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö VP_HR ‡πÅ‡∏•‡∏∞ President

### 6. **App.jsx Updates**
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Register
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Email/Password Login
- ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ state ‡πÅ‡∏•‡∏∞ localStorage

---

## üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡∏•‡∏≤‡∏á (Shared Email) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Faculty

### **‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
1. **‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô** - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
2. **‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏Ñ‡∏ì‡∏∞‡∏ï‡πà‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•** - ‡∏ñ‡πâ‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ

### **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
```
‚ùå ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:
- ‡∏Ñ‡∏ì‡∏∞ A ‡πÉ‡∏ä‡πâ email: shared@spu.ac.th
- ‡∏Ñ‡∏ì‡∏∞ B ‡πÉ‡∏ä‡πâ email: shared@spu.ac.th (‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ì‡∏∞ A)

‚úÖ ‡πÑ‡∏î‡πâ:
- ‡∏Ñ‡∏ì‡∏∞ A ‡πÉ‡∏ä‡πâ email: shared@spu.ac.th
- ‡∏Ñ‡∏ì‡∏∞ B ‡πÉ‡∏ä‡πâ email: another@spu.ac.th (‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏∑‡πà‡∏ô)
```

### **‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:**
- **‡πÉ‡∏ô RegisterPage.jsx (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 132-164):**
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Faculty: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÉ‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - ‡∏ñ‡πâ‡∏≤‡∏û‡∏ö ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á Error: "‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏Ñ‡∏ì‡∏∞‡∏ï‡πà‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•"

### **Database Structure ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Users:**

```javascript
{
  uid: "firebase-user-id",
  email: "user@spu.ac.th",
  fullName: "‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•",
  role: "faculty" | "hr" | "vp_hr" | "president",
  facultyId: "digital" | null,  // null ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà faculty
  facultyName: "‡∏Ñ‡∏ì‡∏∞‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢" | null,  // null ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà faculty
  createdAt: Timestamp
}
```

---

## üîê Authentication Flow

### **Register Flow:**
1. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Register
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ã‡πâ‡∏≥ (‡∏ó‡∏∏‡∏Å role)
3. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Faculty: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏µ‡πÉ‡∏ô‡∏Ñ‡∏ì‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
4. ‡∏™‡∏£‡πâ‡∏≤‡∏á User ‡πÉ‡∏ô Firebase Auth (`createUserWithEmailAndPassword`)
5. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡∏á Firestore (`artifacts/{appId}/public/data/users/{uid}`)

### **Login Flow:**
1. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å Email/Password ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Role
2. Login ‡∏î‡πâ‡∏ß‡∏¢ Firebase Auth (`signInWithEmailAndPassword`)
3. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å Firestore (`getUserByEmail`)
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (`checkAccess`)
5. ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö

---

## üìÇ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

### **Database:**
- `config/firebase.js` - Firebase Configuration
- `utils/userService.js` - User Database Functions

### **Components:**
- `components/RegisterPage.jsx` - ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
- `components/LoginPage.jsx` - ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
- `App.jsx` - Main App (‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Authentication)

---

## üéØ ‡∏™‡∏£‡∏∏‡∏õ

**Database:** Firebase Firestore  
**Authentication:** Firebase Authentication (Email/Password)  
**Fallback:** localStorage (Demo Mode)  
**‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡∏•‡∏≤‡∏á:** ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏Ñ‡∏ì‡∏∞‡∏ï‡πà‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Faculty)

